use strict;
use warnings;
use ID2PDF;

my $conv = new ID2PDF();
my $ids = "24024505, 24161383, NOT_FOUND, 20192166, 20795911, 7841152, 23837602, 24684892, 22713230, 24465824, 17302336, 17302336, 17302336, NOT_FOUND, NOT_FOUND, 24961596, 20827377, 20049834, 23787695, 23597259, 9804429, 9862283, 15737157, 24124881, 24176888, 18393894, 17614155, 23631768, 24101456, 19376175, NOT_FOUND, 17455953, 16478096, 21376802, 23315277, 21664489, 21382431, 24627639, 23621530, NOT_FOUND, 24139157, 20719239, 18930072, 19874832, 20447378, NOT_FOUND, 23870252, 23675949, 22245848, 22007674, NOT_FOUND, 23669788, 23545165, 20355823, 24039066, 15829015, 20519360, 21698080, 20347276, 19386275, NOT_FOUND, 18645730, 16868127, 20827377, 19206452, 17460721, 16125267, 17482261, 21456573, 21995538, 22334781, 12235356, NOT_FOUND, 22863381, NOT_FOUND, NOT_FOUND, 22293418, 22331707, 22393286, 20654680, 20226238, 23050635, 9766251, NOT_FOUND, NOT_FOUND, 19199447, 21499425, NOT_FOUND, 20961102, 21612298, 20452423, 21057907, 20150514, 19206564, 23020080, 24204141, 23885175, 21240478, 22230430, 23057773, 24143098, 24307203, 23667135, 24748114, 23493450, 23326189, 20082119, 20060075, 21692495, 24177351, 22524388, 24797313, 19375161, 22013878, 12783819, 19444929, NOT_FOUND, 24188191, 16630940, 20420656, 12635003, 23043330, 23120749, NOT_FOUND, 26412950, NOT_FOUND, 24309155, 21738604, 15451059, 21424457, 21919194, 23184580, 24184372, 23319294, 21673379, 22998219, 23620104, 16004566, 22533492, 24892190, 22732239, 21170131, 19226599, 20356032, 22334586, NOT_FOUND, NOT_FOUND, 10837677, 7905625, 18954125, 20890913, 23063827, 15031496, 21764452, 24444157, 24375170, 8863138, 21793674, 24103304, 25162369, 25072719";
my @id_array = split(', ', $ids);

$| = 1;
open(my $fh, '>', "MedIDInfo.file");
my $num = 1;
foreach my $id (@id_array){
  print "$num / ".(scalar @id_array)."\n";
  $num++;
  if($id eq "NOT_FOUND"){next;}
  my @fullTextLinks;
  eval{
    @fullTextLinks = $conv->getLinksToPDF($id);
  } or print $fh "No full-text-links: $id\n";
  if(not @fullTextLinks){next;}
  foreach my $fullTextLink (@fullTextLinks){
    eval{
      my $pdfLink = $conv->getPDFLink($fullTextLink);
      print $fh "$id : $pdfLink\n";
      sleep(1);
    }or print $fh "No PDF: $fullTextLink\n";
  }
}


# my @links = $conv->getLinksToPDF($id);
# print print join("\n", @links)."\n";
# my $pdf = $conv->getPDFLink($links[0])."\n";
#
# $conv->downloadPDF($pdf, "pdf/$id");
#$conv->getPDF($id);
