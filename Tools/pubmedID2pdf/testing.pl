use strict;
use warnings;
use ID2PDF;

my $conv = new ID2PDF();

#print $conv->getPDFLink("http://onlinelibrary.wiley.com/doi/10.1002/smll.200801546/abstract") . "\n";
#$conv->downloadPDF("http://onlinelibrary.wiley.com/store/10.1002/smll.200801546/asset/701_ftp.pdf?v=1&t=j8w26c0i&s=a085da98078cceb2e00a7ebaeb3ba9fbb02ada06","pdf/test.pdf");
my $ids = "23914771, 21294262, 17928048, 24994950, 23933526, 23933526, 23933526, 20626687, 24507278, 22073987, 22151883, NOT_FOUND, 21819574, 21859444, 21936889, 21939512, 22276919, 23961234, NOT_FOUND, 22734787, 23818776, 18675453, 22011673, NOT_FOUND, NOT_FOUND, NOT_FOUND, NOT_FOUND, 22524043, 19581717, 19928178, 18483503, 23305071, 22865601, 15784770, 19738601, 23194376, NOT_FOUND, 23237634, 24024505, 24161383, NOT_FOUND, 20192166, 20795911, 7841152, 23837602, 24684892, 22713230, 24465824, 17302336, 17302336, 17302336, NOT_FOUND, NOT_FOUND, 24961596, 20827377, 20049834, 23787695, 23597259, 9804429, 9862283, 15737157, 24124881, 24176888, 18393894, 17614155, 23631768, 24101456, 19376175, NOT_FOUND, 17455953, 16478096, 21376802, 23315277, 21664489, 21382431, 24627639, 23621530, NOT_FOUND, 24139157, 20719239, 18930072, 19874832, 20447378, NOT_FOUND, 23870252, 23675949, 22245848, 22007674, NOT_FOUND, 23669788, 23545165, 20355823, 24039066, 15829015, 20519360, 21698080, 20347276, 19386275, NOT_FOUND, 18645730, 16868127, 20827377, 19206452, 17460721, 16125267, 17482261, 21456573, 21995538, 22334781, 12235356, NOT_FOUND, 22863381, NOT_FOUND, NOT_FOUND, 22293418, 22331707, 22393286, 20654680, 20226238, 23050635, 9766251, NOT_FOUND, NOT_FOUND, 19199447, 21499425, NOT_FOUND, 20961102, 21612298, 20452423, 21057907, 20150514, 19206564, 23020080, 24204141, 23885175, 21240478, 22230430, 23057773, 24143098, 24307203, 23667135, 24748114, 23493450, 23326189, 20082119, 20060075, 21692495, 24177351, 22524388, 24797313, 19375161, 22013878, 12783819, 19444929, NOT_FOUND, 24188191, 16630940, 20420656, 12635003, 23043330, 23120749, NOT_FOUND, 26412950, NOT_FOUND, 24309155, 21738604, 15451059, 21424457, 21919194, 23184580, 24184372, 23319294, 21673379, 22998219, 23620104, 16004566, 22533492, 24892190, 22732239, 21170131, 19226599, 20356032, 22334586, NOT_FOUND, NOT_FOUND, 10837677, 7905625, 18954125, 20890913, 23063827, 15031496, 21764452, 24444157, 24375170, 8863138, 21793674, 24103304, 25162369, 25072719, 12469721, NOT_FOUND, 14713355, 22943128, 19945136, 19058285, 23624273, 23046173, 23132795, NOT_FOUND, 21412442, 25042418, 21452862, 11522485, 15553228, 15342180, 11697206, NOT_FOUND, 9098875, 24524369";
my @id_array = split(', ', $ids);

# my %hash   = map { $_ => 1 } @id_array;
# @id_array = keys %hash;
@id_array = grep ! /NOT_FOUND/, @id_array;

$| = 1;
# open(my $fh, '>', "MedIDInfo3.file");
my $num = 1;
foreach my $id (@id_array){
  # print "$num / ".(scalar @id_array)."\n";
  $num++;
  my @fullTextLinks;
  eval{
    @fullTextLinks = $conv->getLinksToPDF($id);
  } or print "No full-text-links: $id\n";
  if(not @fullTextLinks){next;}
  my $success = 0;
#  print "Full Text Links: ". join(", ", @fullTextLinks)."\n";
  foreach my $fullTextLink (@fullTextLinks){
    last if $success;
    eval{
      my $pdfLink = $conv->getPDFLink($fullTextLink);
      print "$id : $pdfLink\n";
      $success = 1 if $pdfLink;
    }or print "No PDF: $id | $fullTextLink \n"
  }
}

#TODO 23621530 : http://www.eurekaselect.com/images/journal-flyer/cpd-flyer.pdf


# my @links = $conv->getLinksToPDF($id);
# print print join("\n", @links)."\n";
# my $pdf = $conv->getPDFLink($links[0])."\n";
#
# $conv->downloadPDF($pdf, "pdf/$id");
#$conv->getPDF($id);
